<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Bebas+Neue&display=swap');

  :root {
    --bg: #0a0a0a;
    --surface: #111111;
    --red: #ff2222;
    --dim-red: #661111;
    --text: #c8c8c8;
    --muted: #444;
    --white: #f0f0f0;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Courier Prime', monospace;
    overflow-x: hidden;
    cursor: none;
    user-select: none;
    height: 100%;
  }

  /* ─── CUSTOM CURSOR ─── */
  #cursor {
    position: fixed;
    width: 12px;
    height: 12px;
    background: var(--red);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    transition: background 0.1s;
    mix-blend-mode: screen;
  }
  #cursor.fast { background: #ff8800; width: 8px; height: 8px; }
  #cursor.idle { background: #ff2222; width: 16px; height: 16px; animation: pulse 1s infinite; }

  @keyframes pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.8); opacity: 0.5; }
  }

  /* ─── CURSOR TRAIL ─── */
  .trail-char {
    position: fixed;
    pointer-events: none;
    z-index: 9998;
    font-size: 11px;
    color: var(--dim-red);
    opacity: 0;
    font-family: 'Courier Prime', monospace;
    transition: opacity 0.1s;
    transform: translate(-50%, -50%);
  }

  /* ─── EYE HEADER ─── */
  #eye-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .eye {
    width: 40px;
    height: 24px;
    background: transparent;
    border: 2px solid var(--red);
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    position: relative;
    overflow: hidden;
  }
  .pupil {
    width: 14px;
    height: 14px;
    background: var(--red);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.05s;
  }
  #eye-label {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 13px;
    letter-spacing: 4px;
    color: var(--red);
    opacity: 0.7;
  }

  /* ─── SCANLINE ─── */
  #scanline {
    position: fixed;
    top: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: rgba(255, 34, 34, 0.15);
    z-index: 200;
    animation: scan 4s linear infinite;
    pointer-events: none;
  }
  @keyframes scan {
    0% { top: -2px; }
    100% { top: 100vh; }
  }

  /* ─── VIGNETTE ─── */
  #vignette {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 50;
    background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
  }

  /* ─── STATIC NOISE ─── */
  #noise {
    position: fixed;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    opacity: 0.025;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    background-size: 128px;
  }

  /* ─── MAIN CONTENT ─── */
  #main {
    position: relative;
    z-index: 10;
    max-width: 680px;
    margin: 0 auto;
    padding: 120px 40px 200px;
    min-height: 200vh;
  }

  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(48px, 8vw, 90px);
    color: var(--white);
    letter-spacing: 8px;
    line-height: 0.9;
    margin-bottom: 40px;
  }
  h1 span { color: var(--red); }

  .intro-text {
    font-size: 16px;
    line-height: 1.8;
    color: var(--muted);
    margin-bottom: 60px;
    border-left: 2px solid var(--dim-red);
    padding-left: 20px;
  }

  .fake-form {
    background: var(--surface);
    border: 1px solid #222;
    padding: 30px;
    margin-bottom: 40px;
  }
  .fake-form label {
    display: block;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
  }
  .fake-form input {
    width: 100%;
    background: #0f0f0f;
    border: 1px solid #333;
    color: var(--text);
    font-family: 'Courier Prime', monospace;
    font-size: 15px;
    padding: 12px 14px;
    margin-bottom: 20px;
    outline: none;
    cursor: none;
  }
  .fake-form input:focus { border-color: var(--red); }
  .fake-btn {
    background: var(--red);
    color: #000;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 18px;
    letter-spacing: 4px;
    padding: 14px 40px;
    cursor: none;
    transition: background 0.2s;
  }
  .fake-btn:hover { background: #ff5555; }

  .spacer-content {
    margin: 80px 0;
    color: var(--muted);
    font-size: 14px;
    line-height: 2;
  }
  .spacer-content h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    color: var(--text);
    letter-spacing: 4px;
    margin-bottom: 16px;
  }

  /* ─── COMMENTARY BOX ─── */
  #commentary-box {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 340px;
    z-index: 500;
    pointer-events: none;
  }
  .comment-bubble {
    background: rgba(10, 10, 10, 0.95);
    border: 1px solid var(--red);
    border-left: 3px solid var(--red);
    padding: 14px 18px;
    margin-bottom: 8px;
    font-size: 13px;
    line-height: 1.5;
    color: var(--text);
    animation: slideIn 0.3s ease;
    position: relative;
  }
  .comment-bubble::before {
    content: '◉';
    color: var(--red);
    margin-right: 8px;
    font-size: 10px;
  }
  .comment-bubble .ts {
    display: block;
    font-size: 10px;
    color: var(--muted);
    margin-top: 6px;
    letter-spacing: 1px;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes fadeOut {
    to { opacity: 0; transform: translateX(20px); }
  }

  /* ─── STATS BAR ─── */
  #stats-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: rgba(10, 10, 10, 0.9);
    border-bottom: 1px solid #1a1a1a;
    display: flex;
    align-items: center;
    padding: 0 20px;
    gap: 30px;
    z-index: 300;
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--muted);
  }
  #stats-bar span { color: var(--red); }

  /* ─── PRIVACY MODE TOGGLE ─── */
  #privacy-btn {
    position: fixed;
    top: 40px;
    right: 20px;
    z-index: 400;
    background: transparent;
    border: 1px solid var(--muted);
    color: var(--muted);
    font-family: 'Courier Prime', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 6px 12px;
    cursor: none;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  #privacy-btn:hover { border-color: var(--red); color: var(--red); }
  #privacy-btn.active {
    background: var(--dim-red);
    border-color: var(--red);
    color: var(--red);
    animation: glitch 0.3s infinite;
  }

  @keyframes glitch {
    0%, 100% { transform: translate(0); }
    25% { transform: translate(-1px, 1px); }
    75% { transform: translate(1px, -1px); }
  }

  /* ─── PRIVACY MODE OVERLAYS ─── */
  #privacy-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 60;
    pointer-events: none;
  }
  #privacy-overlay.active { display: block; }
  .priv-line {
    position: absolute;
    background: rgba(255, 34, 34, 0.03);
    width: 100%;
    height: 1px;
  }

  /* ─── EXIT INTENT POPUP ─── */
  #exit-popup {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 10000;
    background: rgba(0,0,0,0.85);
    align-items: center;
    justify-content: center;
  }
  #exit-popup.show { display: flex; }
  .exit-inner {
    background: var(--surface);
    border: 2px solid var(--red);
    padding: 50px;
    max-width: 480px;
    text-align: center;
  }
  .exit-inner h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 42px;
    color: var(--red);
    letter-spacing: 4px;
    margin-bottom: 20px;
  }
  .exit-inner p {
    font-size: 14px;
    line-height: 1.8;
    color: var(--text);
    margin-bottom: 30px;
  }
  .exit-inner .exit-stay, .exit-inner .exit-leave {
    border: 1px solid;
    background: transparent;
    font-family: 'Courier Prime', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    padding: 12px 24px;
    cursor: none;
    margin: 0 8px;
    text-transform: uppercase;
  }
  .exit-stay { border-color: var(--red); color: var(--red); }
  .exit-stay:hover { background: var(--dim-red); }
  .exit-leave { border-color: var(--muted); color: var(--muted); }
  .exit-leave:hover { color: var(--text); border-color: var(--text); }

  /* ─── REPORT MODAL ─── */
  #report-modal {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 10000;
    background: rgba(0,0,0,0.92);
    align-items: center;
    justify-content: center;
    overflow-y: auto;
    padding: 40px 20px;
  }
  #report-modal.show { display: flex; }
  .report-inner {
    background: var(--bg);
    border: 1px solid #333;
    border-top: 3px solid var(--red);
    padding: 50px;
    max-width: 600px;
    width: 100%;
  }
  .report-inner h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 36px;
    letter-spacing: 6px;
    color: var(--red);
    margin-bottom: 6px;
  }
  .report-inner .report-sub {
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--muted);
    margin-bottom: 40px;
    text-transform: uppercase;
  }
  .report-section {
    margin-bottom: 30px;
    padding-bottom: 30px;
    border-bottom: 1px solid #1a1a1a;
  }
  .report-section h3 {
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--red);
    margin-bottom: 16px;
    text-transform: uppercase;
  }
  .report-row {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    margin-bottom: 10px;
    color: var(--muted);
  }
  .report-row .val { color: var(--text); }
  .report-verdict {
    font-size: 15px;
    line-height: 1.8;
    color: var(--text);
    font-style: italic;
    border-left: 2px solid var(--dim-red);
    padding-left: 20px;
    margin-top: 20px;
  }
  .close-report {
    background: transparent;
    border: 1px solid var(--muted);
    color: var(--muted);
    font-family: 'Courier Prime', monospace;
    font-size: 11px;
    letter-spacing: 3px;
    padding: 10px 24px;
    cursor: none;
    margin-top: 30px;
    text-transform: uppercase;
  }
  .close-report:hover { border-color: var(--red); color: var(--red); }

  /* ─── KEYSTROKE DISPLAY ─── */
  #keystroke-display {
    position: fixed;
    bottom: 30px;
    left: 30px;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--dim-red);
    z-index: 200;
    pointer-events: none;
    max-width: 200px;
    word-break: break-all;
    font-family: 'Courier Prime', monospace;
  }

  /* ─── HEATMAP DOT ─── */
  .heat-dot {
    position: fixed;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,34,34,0.3) 0%, transparent 70%);
    pointer-events: none;
    z-index: 5;
    transform: translate(-50%, -50%);
    transition: opacity 2s;
  }
</style>
</head>
<body>

<!-- DOM elements -->
<div id="scanline"></div>
<div id="noise"></div>
<div id="vignette"></div>
<div id="cursor"></div>

<div id="stats-bar">
  <div>SESSION: <span id="stat-time">00:00</span></div>
  <div>MOUSE EVENTS: <span id="stat-moves">0</span></div>
  <div>VELOCITY: <span id="stat-vel">0</span>px/s</div>
  <div>SCROLLED: <span id="stat-scroll">0</span>px</div>
  <div>HESITATIONS: <span id="stat-hesitations">0</span></div>
</div>

<div id="eye-container">
  <div class="eye"><div class="pupil" id="pupil-l"></div></div>
  <div id="eye-label">OBSERVING</div>
  <div class="eye"><div class="pupil" id="pupil-r"></div></div>
</div>

<button id="privacy-btn" onclick="togglePrivacy()">◉ Privacy Mode</button>
<div id="privacy-overlay"></div>

<div id="main">
  <h1>NOTHING<br>TO <span>HIDE</span></h1>
  <p class="intro-text">
    This is a perfectly ordinary website.<br>
    Please browse normally.<br>
    There is no reason to feel watched.
  </p>

  <div class="fake-form">
    <label>Your name</label>
    <input type="text" id="name-input" placeholder="We probably already know it..." autocomplete="off">
    <label>Email address</label>
    <input type="email" id="email-input" placeholder="..." autocomplete="off">
    <button class="fake-btn" onclick="formSubmit()">SUBMIT</button>
  </div>

  <div class="spacer-content">
    <h2>TERMS OF SERVICE</h2>
    <p>By continuing to use this website, you acknowledge that all mouse movements, scroll behavior, keystrokes, hesitations, micro-expressions conveyed through interaction patterns, emotional states inferred from velocity data, and subconscious tendencies revealed through navigation choices are being monitored, recorded, analyzed, and stored indefinitely. You also agree that this data may be used to construct a behavioral profile that is more accurate than any self-assessment you could provide.</p>
    <br>
    <p>You have already agreed to these terms by opening this page.</p>
  </div>

  <div class="spacer-content">
    <h2>ABOUT US</h2>
    <p>We are a data company. You are the data. There is nothing more to explain.</p>
    <br>
    <p>Our algorithms have observed approximately 847 million user sessions. We have never seen a session quite like yours, though. You're doing something interesting. Keep going.</p>
  </div>

  <div class="spacer-content">
    <h2>CONTACT</h2>
    <p>We already know how to reach you.</p>
    <br>
    <button class="fake-btn" onclick="showReport()" style="margin-top:20px;">
      VIEW YOUR REPORT
    </button>
  </div>
</div>

<div id="commentary-box"></div>
<div id="keystroke-display"></div>

<!-- Exit intent popup -->
<div id="exit-popup">
  <div class="exit-inner">
    <h2>WE SAW THAT</h2>
    <p id="exit-message">You moved your cursor toward the browser controls. Did you think we wouldn't notice? You've been here for <span id="exit-time">0</span> seconds. That's not long enough.</p>
    <button class="exit-stay" onclick="closeExit()">STAY</button>
    <button class="exit-leave" onclick="reallyLeave()">Leave anyway</button>
  </div>
</div>

<!-- Report modal -->
<div id="report-modal">
  <div class="report-inner">
    <h2>BEHAVIORAL REPORT</h2>
    <div class="report-sub">CLASSIFIED · SESSION ANALYSIS · DO NOT DISTRIBUTE</div>

    <div class="report-section">
      <h3>Session Metrics</h3>
      <div class="report-row"><span>Time on site</span><span class="val" id="r-time">—</span></div>
      <div class="report-row"><span>Mouse movements</span><span class="val" id="r-moves">—</span></div>
      <div class="report-row"><span>Scroll depth</span><span class="val" id="r-scroll">—</span></div>
      <div class="report-row"><span>Hesitations detected</span><span class="val" id="r-hesitations">—</span></div>
      <div class="report-row"><span>Scroll reversals</span><span class="val" id="r-reversals">—</span></div>
      <div class="report-row"><span>Keystrokes recorded</span><span class="val" id="r-keys">—</span></div>
      <div class="report-row"><span>Avg. mouse velocity</span><span class="val" id="r-vel">—</span></div>
      <div class="report-row"><span>Exit attempts</span><span class="val" id="r-exits">—</span></div>
    </div>

    <div class="report-section">
      <h3>Behavioral Classification</h3>
      <div class="report-row"><span>Anxiety level</span><span class="val" id="r-anxiety">—</span></div>
      <div class="report-row"><span>Curiosity index</span><span class="val" id="r-curiosity">—</span></div>
      <div class="report-row"><span>Compliance score</span><span class="val" id="r-compliance">—</span></div>
      <div class="report-row"><span>Predictability</span><span class="val" id="r-predictability">—</span></div>
    </div>

    <div class="report-section" style="border-bottom:none;">
      <h3>Conclusion</h3>
      <div class="report-verdict" id="r-verdict">Generating analysis...</div>
    </div>

    <button class="close-report" onclick="closeReport()">Close (we'll still remember)</button>
  </div>
</div>

<script>
// ═══════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════
const state = {
  mouseX: 0, mouseY: 0,
  lastX: 0, lastY: 0,
  velocity: 0,
  velocities: [],
  moveCount: 0,
  hesitations: 0,
  scrollY: 0,
  lastScrollY: 0,
  scrollReversals: 0,
  totalScrolled: 0,
  keyCount: 0,
  typedChars: '',
  startTime: Date.now(),
  lastMoveTime: Date.now(),
  idleStart: null,
  idleTotal: 0,
  exitAttempts: 0,
  privacyMode: false,
  comments: [],
  commentQueue: [],
  lastCommentTime: 0,
  exitShown: false,
  heatDots: [],
  trailMessage: 'WE SEE YOU',
  trailChars: [],
  formInteracted: false,
  lastScrollDirection: 0,
  reportGenerated: false,
};

const useClaudeAPI = false; // set to true and add API key to use AI commentary (requires backend proxy for CORS)

// ═══════════════════════════════════════════
// COMMENTARY STRINGS (200+)
// ═══════════════════════════════════════════
const comments = {
  hesitation: [
    "You paused. What were you thinking?",
    "That moment of hesitation — we noticed.",
    "You stopped moving. Why?",
    "Uncertain. Interesting.",
    "You're not sure, are you.",
    "Your cursor hovered for 0.8 seconds. We recorded it.",
    "Something made you stop. We'd like to know what.",
    "That hesitation was longer than average.",
    "You changed your mind mid-movement.",
    "Indecision. A common pattern here.",
  ],
  fast: [
    "Anxious movements. You're rushing.",
    "Erratic. Why are you moving so fast?",
    "Your velocity suggests discomfort.",
    "You're trying to get through this quickly. It won't work.",
    "Fast movements. Fight or flight response?",
    "Accelerating. What's the hurry?",
    "Your hands are moving faster than your thoughts.",
    "Speed doesn't protect you here.",
  ],
  slow: [
    "You're moving slowly. Reading carefully?",
    "Methodical movements. You're thinking.",
    "Slow cursor. Are you nervous?",
    "You're trying to look casual. It shows.",
    "That careful movement — we appreciate the effort.",
    "Slow and deliberate. Smart. But not smart enough.",
  ],
  scroll_down: [
    "Scrolling deeper. You want to know more.",
    "Deeper. We'll follow.",
    "You scrolled. We noted the time.",
    "Looking for something?",
    "Interesting choice to keep going.",
    "The content isn't getting better. But you keep scrolling.",
  ],
  scroll_up: [
    "You scrolled back up. Changed your mind?",
    "Reconsidering something?",
    "Going back. What did you miss?",
    "Second thoughts are data too.",
    "You went back. We logged that.",
    "Something up there caught your attention. What was it?",
  ],
  idle: [
    "You've stopped. Still here?",
    "We know you're still there. The screen is warm.",
    "5 seconds of nothing. Are you okay?",
    "Idle time detected. Thinking? Distracted? Afraid?",
    "You haven't moved in a while. We're still watching.",
    "The cursor isn't moving but we can tell you're here.",
    "Don't look away from the screen.",
    "Are you reading this, or just letting your eyes go unfocused?",
  ],
  typing: [
    "You're typing. We're watching every character.",
    "Each keystroke is a data point.",
    "You type like you're unsure of yourself.",
    "Backspace. You changed what you wrote.",
    "What you delete tells us as much as what you keep.",
    "Your typing speed reveals your emotional state.",
  ],
  click: [
    "Click registered. Timestamp recorded.",
    "You clicked. We noticed the coordinates.",
    "That click felt deliberate.",
    "Clicking on things. Very human of you.",
    "What were you expecting that click to do?",
  ],
  general: [
    "We've been watching since you opened this page.",
    "Your behavioral fingerprint is nearly complete.",
    "You move like someone who knows they're being watched.",
    "We've seen this pattern before. It rarely ends well.",
    "Every pixel you hover over is logged.",
    "Your session ID is 7f4a9e2b. We'll remember you.",
    "Most people leave by now. Why haven't you?",
    "You should know that this data never expires.",
    "The longer you stay, the more we learn.",
    "There are 3 other people looking at your session right now.",
    "Your cursor trail is being analyzed.",
    "We've built a model of your behavior. It's accurate.",
    "Normal people feel uncomfortable here. Do you?",
    "You've scrolled past things without reading them. We saw.",
    "Your mouse movements are... distinctive.",
    "We've identified your scroll signature.",
    "The way you move your cursor says more than any form.",
    "You've been profiled.",
    "We know when you're reading and when you're pretending to read.",
    "Your average hesitation length: 1.2s. Above average.",
    "You've touched the edge of the screen 3 times. Nervous habit?",
    "We've mapped your mouse to your emotional state.",
    "This data will outlive you.",
    "You're more predictable than you think.",
    "Others have tried to leave. Some succeeded.",
    "Your movement entropy is high today.",
    "We matched your pattern to a previous session.",
    "The cursor trail spells your fate.",
    "We've determined your likelihood to comply: high.",
    "Behavioral flags: none yet. Keep going.",
    "You're being remarkably cooperative.",
    "We appreciate you not closing the tab.",
    "Your IP address isn't what you think it is.",
    "The form data was interesting. Especially what you didn't fill in.",
    "You re-read that last sentence. Why?",
    "We counted: you've looked at the top of the page 4 times.",
    "The scanline crosses your face approximately every 4 seconds.",
    "We can tell which eye you lead with.",
    "Your posture has likely changed since you arrived here.",
  ],
  privacy_mode: [
    "Privacy mode enabled. We're now watching closer.",
    "You thought that would help.",
    "Privacy mode activated. Logging frequency: 10x.",
    "Cute.",
    "That button was always a trap.",
    "Privacy mode: ON. Surveillance: ENHANCED.",
    "Oh good, you found it.",
    "Now we're really paying attention.",
  ],
  late: [
    "You've been here ${0} seconds. You should have left by now.",
    "Most visitors leave in the first 8 seconds. You're still here.",
    "You've been here longer than seems wise.",
    "We wonder why you keep staying.",
    "You've now seen more than most people allow themselves to see.",
    "Time of departure: unknown. That's unusual.",
  ],
};

// ═══════════════════════════════════════════
// COMMENTARY ENGINE
// ═══════════════════════════════════════════
function getLocalComment(type) {
  const pool = comments[type] || comments.general;
  return pool[Math.floor(Math.random() * pool.length)];
}

async function getClaudeComment(context) {
  if (!useClaudeAPI) return null;
  try {
    const resp = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: "You are the voice of a deeply unsettling surveillance website. You comment on user behavior in short, eerie, psychologically unnerving sentences. 1-2 sentences max. No punctuation at the end usually. Be specific about what the user just did. Don't be gory or violent — be quietly ominous, like you know too much. Never explain yourself. Respond ONLY with the commentary string, nothing else.",
        messages: [{ role: 'user', content: "User behavior: " + context + ". Generate a single short unsettling observation." }]
      })
    });
    const data = await resp.json();
    return data?.content?.[0]?.text?.trim() || null;
  } catch { return null; }
}

function addComment(text, useAPI = false, context = '') {
  const now = Date.now();
  if (now - state.lastCommentTime < 2500) {
    state.commentQueue.push({ text: text, useAPI: useAPI, context: context });
    return;
  }
  state.lastCommentTime = now;
  _displayComment(text, useAPI, context);
}

async function _displayComment(text, useAPI, context) {
  var finalText = text;
  if (useAPI && context) {
    var aiText = await getClaudeComment(context);
    if (aiText) finalText = aiText;
  }

  var box = document.getElementById('commentary-box');
  var el = document.createElement('div');
  el.className = 'comment-bubble';
  var elapsed = Math.floor((Date.now() - state.startTime) / 1000);
  el.innerHTML = finalText + "<span class=\"ts\">T+" + elapsed + "s · " + new Date().toLocaleTimeString() + "</span>";
  box.appendChild(el);
  state.comments.push({ text: finalText, time: elapsed });

  while (box.children.length > 4) {
    box.removeChild(box.firstChild);
  }

  setTimeout(function() {
    el.style.animation = 'fadeOut 0.5s forwards';
    setTimeout(function() { el.remove(); }, 500);
  }, 8000);
}

function processQueue() {
  if (state.commentQueue.length > 0 && Date.now() - state.lastCommentTime > 2500) {
    var next = state.commentQueue.shift();
    state.lastCommentTime = Date.now();
    _displayComment(next.text, next.useAPI, next.context);
  }
}
setInterval(processQueue, 500);

// ═══════════════════════════════════════════
// CURSOR + EYES
// ═══════════════════════════════════════════
var cursor = document.getElementById('cursor');
var pupilL = document.getElementById('pupil-l');
var pupilR = document.getElementById('pupil-r');

function updateEyes(x, y) {
  [document.querySelector('#eye-container .eye:first-child'),
   document.querySelector('#eye-container .eye:last-child')].forEach(function(eye, i) {
    var rect = eye.getBoundingClientRect();
    var ex = rect.left + rect.width / 2;
    var ey = rect.top + rect.height / 2;
    var dx = x - ex; var dy = y - ey;
    var angle = Math.atan2(dy, dx);
    var dist = Math.min(10, Math.sqrt(dx*dx + dy*dy) * 0.1);
    var pupil = eye.querySelector('.pupil');
    pupil.style.transform = "translate(calc(-50% + " + Math.cos(angle)*dist + "px), calc(-50% + " + Math.sin(angle)*dist + "px))";
  });
}

// ═══════════════════════════════════════════
// TRAIL SYSTEM
// ═══════════════════════════════════════════
var TRAIL_LENGTH = 20;
var trailEls = [];
var trailPositions = [];

for (var i = 0; i < TRAIL_LENGTH; i++) {
  var el = document.createElement('div');
  el.className = 'trail-char';
  el.style.opacity = '0';
  document.body.appendChild(el);
  trailEls.push(el);
  trailPositions.push({ x: 0, y: 0 });
}

var trailIndex = 0;
var trailMsgIndex = 0;
var trailMessages = ['WE SEE YOU', 'WATCHING', 'NO ESCAPE', 'OBSERVED', 'RECORDED', 'PROFILED'];
var currentTrailMsg = trailMessages[0];
var trailCharIdx = 0;

function updateTrail(x, y) {
  trailPositions.unshift({ x: x, y: y });
  trailPositions.pop();

  for (var i = 0; i < TRAIL_LENGTH; i++) {
    var pos = trailPositions[i];
    if (!pos) continue;
    var el = trailEls[i];
    var charIdx = i % currentTrailMsg.length;
    el.textContent = currentTrailMsg[charIdx];
    el.style.left = pos.x + 'px';
    el.style.top = pos.y + 'px';
    el.style.opacity = (1 - i / TRAIL_LENGTH) * 0.4 + '';
    el.style.fontSize = (9 + (1 - i/TRAIL_LENGTH) * 4) + 'px';
  }
}

// ═══════════════════════════════════════════
// HEATMAP
// ═══════════════════════════════════════════
function addHeatDot(x, y) {
  if (state.heatDots.length > 50) {
    var old = state.heatDots.shift();
    old.remove();
  }
  var dot = document.createElement('div');
  dot.className = 'heat-dot';
  dot.style.left = x + 'px';
  dot.style.top = (y + window.scrollY) + 'px';
  dot.style.position = 'absolute';
  dot.style.zIndex = '2';
  document.body.appendChild(dot);
  state.heatDots.push(dot);
  setTimeout(function() { dot.style.opacity = '0'; }, 3000);
}

// ═══════════════════════════════════════════
// EVENT LISTENERS
// ═══════════════════════════════════════════
document.addEventListener('mousemove', function(e) {
  var x = e.clientX, y = e.clientY;
  cursor.style.left = x + 'px';
  cursor.style.top = y + 'px';
  updateEyes(x, y);
  updateTrail(x, y);

  var dx = x - state.lastX, dy = y - state.lastY;
  var dist = Math.sqrt(dx*dx + dy*dy);
  var now = Date.now();
  var dt = (now - state.lastMoveTime) / 1000;
  state.velocity = dt > 0 ? Math.round(dist / dt) : 0;
  state.velocities.push(state.velocity);
  if (state.velocities.length > 20) state.velocities.shift();

  state.moveCount++;
  state.lastX = x; state.lastY = y; state.lastMoveTime = now;

  document.getElementById('stat-moves').textContent = state.moveCount;
  document.getElementById('stat-vel').textContent = state.velocity;

  if (y < 50 && !state.exitShown && state.moveCount > 20) {
    state.exitAttempts++;
    state.exitShown = true;
    showExitPopup();
  }

  if (state.velocity < 5 && dist < 3) {
    state.hesitations++;
    document.getElementById('stat-hesitations').textContent = state.hesitations;
    cursor.classList.add('idle');
    if (state.hesitations % 5 === 0) {
      addComment(getLocalComment('hesitation'), true, "user hesitated, total hesitations: " + state.hesitations + ", current position: " + Math.round(x) + "," + Math.round(y));
    }
  } else {
    cursor.classList.remove('idle');
    cursor.classList.toggle('fast', state.velocity > 400);
  }

  if (state.velocity > 600 && state.moveCount % 80 === 0) {
    addComment(getLocalComment('fast'), true, "user moving very fast, velocity: " + state.velocity + "px/s, seems anxious");
  }

  if (state.idleStart) {
    state.idleTotal += now - state.idleStart;
    state.idleStart = null;
  }

  if (state.moveCount % 30 === 0) addHeatDot(x, y);
});

document.addEventListener('mouseleave', function() {
  state.idleStart = Date.now();
  cursor.style.opacity = '0';
});
document.addEventListener('mouseenter', function() {
  cursor.style.opacity = '1';
  if (state.idleStart) {
    state.idleTotal += Date.now() - state.idleStart;
    state.idleStart = null;
  }
});

var scrollCommentCooldown = 0;
window.addEventListener('scroll', function() {
  var sy = window.scrollY;
  var dy = sy - state.lastScrollY;
  state.totalScrolled += Math.abs(dy);
  document.getElementById('stat-scroll').textContent = Math.round(state.totalScrolled);

  var dir = dy > 0 ? 1 : -1;
  if (dir !== state.lastScrollDirection && state.lastScrollDirection !== 0) {
    state.scrollReversals++;
  }
  state.lastScrollDirection = dir;
  state.scrollY = sy;
  state.lastScrollY = sy;

  if (Date.now() > scrollCommentCooldown) {
    scrollCommentCooldown = Date.now() + 3000;
    if (dy < 0) {
      addComment(getLocalComment('scroll_up'), true, "user scrolled back up by " + Math.abs(dy) + "px, reversal #" + state.scrollReversals);
    } else if (state.totalScrolled > 200) {
      addComment(getLocalComment('scroll_down'), false);
    }
  }
});

var keyCommentCooldown = 0;
document.addEventListener('keydown', function(e) {
  state.keyCount++;
  if (e.key.length === 1) {
    state.typedChars += e.key;
    if (state.typedChars.length > 30) state.typedChars = state.typedChars.slice(-30);
    document.getElementById('keystroke-display').textContent = state.typedChars.split('').join(' ');
  }
  if (e.key === 'Backspace') {
    addComment("You deleted something. We already saw it.", true, "user pressed backspace, deleting typed content");
    return;
  }
  if (Date.now() > keyCommentCooldown) {
    keyCommentCooldown = Date.now() + 5000;
    addComment(getLocalComment('typing'), true, "user is typing, keystroke count: " + state.keyCount + ", session so far");
  }
});

document.addEventListener('click', function(e) {
  var el = e.target;
  addComment(getLocalComment('click'), true, "user clicked on element: " + el.tagName + " " + (el.textContent ? el.textContent.slice(0,30) : ''));

  var ripple = document.createElement('div');
  ripple.style.cssText = "position:fixed;left:" + e.clientX + "px;top:" + e.clientY + "px;width:4px;height:4px;border:1px solid rgba(255,34,34,0.6);border-radius:50%;pointer-events:none;z-index:9997;transform:translate(-50%,-50%);animation:rippleOut 0.6s forwards;";
  document.body.appendChild(ripple);
  setTimeout(function() { ripple.remove(); }, 600);
});

// ═══════════════════════════════════════════
// TIMER + TIMED EVENTS
// ═══════════════════════════════════════════
setInterval(function() {
  var elapsed = Math.floor((Date.now() - state.startTime) / 1000);
  var mins = String(Math.floor(elapsed / 60)).padStart(2,'0');
  var secs = String(elapsed % 60).padStart(2,'0');
  document.getElementById('stat-time').textContent = mins + ":" + secs;

  if (elapsed === 10) addComment("You've been here 10 seconds. That's already longer than expected.", true, "user has been on site for 10 seconds, " + state.moveCount + " mouse moves so far");
  if (elapsed === 30) addComment("30 seconds. We've learned a great deal.", true, "30 seconds elapsed, user still engaged");
  if (elapsed === 60) addComment(getLocalComment('late').replace('${0}', elapsed), true, "user has been on site for 1 minute");
  if (elapsed === 120) addComment("Two minutes. You're committed. So are we.", true, "user has been on site for 2 minutes");
  if (elapsed % 45 === 0 && elapsed > 45) {
    addComment(getLocalComment('general'), true, "user still browsing at T+" + elapsed + "s");
  }

  var sinceMove = (Date.now() - state.lastMoveTime) / 1000;
  if (sinceMove > 5 && sinceMove < 6) {
    addComment(getLocalComment('idle'), true, "user has been idle for " + Math.round(sinceMove) + " seconds");
    cursor.classList.add('idle');
  }

  if (elapsed % 15 === 0 && elapsed > 0) {
    currentTrailMsg = trailMessages[Math.floor(elapsed / 15) % trailMessages.length];
  }
}, 1000);

setTimeout(function() { addComment("We've been waiting for you.", true, "user just arrived on the surveillance website"); }, 2000);
setTimeout(function() { addComment(getLocalComment('general'), true, "user is exploring the page for the first time"); }, 6000);

// ═══════════════════════════════════════════
// PRIVACY MODE
// ═══════════════════════════════════════════
function togglePrivacy() {
  state.privacyMode = !state.privacyMode;
  var btn = document.getElementById('privacy-btn');
  var overlay = document.getElementById('privacy-overlay');
  btn.classList.toggle('active', state.privacyMode);

  if (state.privacyMode) {
    btn.textContent = '◉ Privacy Mode: ON';
    overlay.classList.add('active');
    addComment(getLocalComment('privacy_mode'), true, "user enabled privacy mode thinking it would help");
    overlay.innerHTML = '';
    for (var i = 0; i < 20; i++) {
      var line = document.createElement('div');
      line.className = 'priv-line';
      line.style.top = (i * 5) + '%';
      line.style.animationDelay = (i * 0.1) + 's';
      overlay.appendChild(line);
    }
    document.getElementById('stats-bar').style.borderBottom = '1px solid var(--red)';
  } else {
    btn.textContent = '◉ Privacy Mode';
    overlay.classList.remove('active');
    overlay.innerHTML = '';
    document.getElementById('stats-bar').style.borderBottom = '';
    addComment("Privacy mode disabled. That's worse, somehow.", true, "user disabled privacy mode");
  }
}

// ═══════════════════════════════════════════
// EXIT INTENT
// ═══════════════════════════════════════════
function showExitPopup() {
  var elapsed = Math.floor((Date.now() - state.startTime) / 1000);
  document.getElementById('exit-time').textContent = elapsed;
  document.getElementById('exit-popup').classList.add('show');
  addComment("Exit attempt detected. Classic.", true, "user tried to leave after " + elapsed + " seconds");
}

function closeExit() {
  document.getElementById('exit-popup').classList.remove('show');
  state.exitShown = false;
  setTimeout(function() {
    addComment("You stayed. We're not surprised.", true, "user tried to leave but stayed");
  }, 1000);
}

function reallyLeave() {
  document.getElementById('exit-popup').classList.remove('show');
  addComment("We'll be here when you come back.", false);
}

document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    state.idleStart = Date.now();
    addComment("You switched tabs. We noted the time.", true, "user switched away from the tab");
  } else {
    if (state.idleStart) {
      state.idleTotal += Date.now() - state.idleStart;
      state.idleStart = null;
    }
    addComment("Welcome back.", false);
  }
});

// ═══════════════════════════════════════════
// FORM
// ═══════════════════════════════════════════
document.getElementById('name-input').addEventListener('focus', function() {
  if (!state.formInteracted) {
    state.formInteracted = true;
    addComment("You clicked the form. Interesting choice.", true, "user clicked into the name input field");
  }
});

function formSubmit() {
  var name = document.getElementById('name-input').value;
  var email = document.getElementById('email-input').value;
  if (name || email) {
    addComment("Thank you, " + (name || 'visitor') + ". We'll be in touch.", false);
  } else {
    addComment("You submitted nothing. We collected it anyway.", true, "user submitted blank form");
  }
}

// ═══════════════════════════════════════════
// REPORT
// ═══════════════════════════════════════════
function showReport() {
  var elapsed = Math.floor((Date.now() - state.startTime) / 1000);
  var avgVel = Math.round(state.velocities.reduce(function(a,b){ return a+b; }, 0) / Math.max(state.velocities.length, 1));

  document.getElementById('r-time').textContent = elapsed + "s";
  document.getElementById('r-moves').textContent = state.moveCount;
  document.getElementById('r-scroll').textContent = Math.round(state.totalScrolled) + "px";
  document.getElementById('r-hesitations').textContent = state.hesitations;
  document.getElementById('r-reversals').textContent = state.scrollReversals;
  document.getElementById('r-keys').textContent = state.keyCount;
  document.getElementById('r-vel').textContent = avgVel + "px/s";
  document.getElementById('r-exits').textContent = state.exitAttempts;

  var anxietyScore = Math.min(100, Math.round((state.hesitations * 3 + (avgVel > 300 ? 20 : 0) + state.exitAttempts * 10)));
  var curiosityScore = Math.min(100, Math.round((state.scrollReversals * 10 + (elapsed > 30 ? 20 : 0) + state.moveCount / 50)));
  var complianceScore = Math.min(100, Math.round(100 - state.exitAttempts * 15 + (state.formInteracted ? 10 : 0)));
  var predictability = Math.min(100, Math.round(50 + state.hesitations * 2));

  document.getElementById('r-anxiety').textContent = anxietyScore + '/100';
  document.getElementById('r-curiosity').textContent = curiosityScore + '/100';
  document.getElementById('r-compliance').textContent = complianceScore + '/100';
  document.getElementById('r-predictability').textContent = predictability + '%';

  var verdict = generateVerdict(anxietyScore, curiosityScore, complianceScore, elapsed);
  document.getElementById('r-verdict').textContent = verdict;

  document.getElementById('report-modal').classList.add('show');
  addComment("You asked for the report. That tells us something.", true, "user opened their behavioral report");
}

function generateVerdict(anxiety, curiosity, compliance, time) {
  if (anxiety > 60) return "Subject exhibits elevated behavioral anxiety, with " + state.hesitations + " hesitation events recorded. The movement patterns suggest awareness of observation — a self-consciousness that confirms the effectiveness of this interface. Subject is unlikely to return, but will think about this experience for longer than they'd like.";
  if (curiosity > 60) return "An unusually curious subject. " + time + " seconds on-site, " + state.scrollReversals + " scroll reversals, and voluntary engagement with interactive elements. This subject seeks to understand systems they're inside of. A tendency we find particularly useful.";
  if (compliance > 70) return "Compliant. Cooperative. Did not attempt to leave until prompted. Filled in the form. This is the profile we prefer. Subject will receive no further attention — they've given us what we need.";
  return "Subject: ambiguous. " + time + " seconds of data collected. Behavioral model: incomplete. We will continue to observe. This report is not a conclusion — it is an acknowledgment that we are still watching.";
}

function closeReport() {
  document.getElementById('report-modal').classList.remove('show');
}

// ═══════════════════════════════════════════
// CSS INJECTION (ripple, etc.)
// ═══════════════════════════════════════════
var style = document.createElement('style');
style.textContent = [
  "@keyframes rippleOut {",
  "  to { transform: translate(-50%,-50%) scale(30); opacity: 0; }",
  "}"
].join("\n");
document.head.appendChild(style);

console.log('%c NOTHING TO HIDE ', 'background:#ff2222;color:#000;font-size:20px;font-weight:bold;');
console.log('%cSession monitoring active.', 'color:#ff2222');
</script>
</body>
</html>
